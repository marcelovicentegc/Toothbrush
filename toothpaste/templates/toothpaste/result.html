{% extends "toothpaste/index.html" %}
{% block content %}
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js'></script>
    <div id='toothpaste'>
        <div id='loading'></div>
        <canvas id='result'></canvas>
    </div>
    <script type='text/javascript'>
        var loading = $('#loading'); 
        var endpoint = '/api/chart/data/{{id}}';
        var color = Chart.helpers.color;
        var freq = [];
        var words = [];

        window.chartColors = {
            grey: 'rgba(32, 32, 32, 0.7)',
            black: 'rgba(0, 0, 0, 0.7)',
        };

        $(document).ready(function() {
            $.fn.goodBye = function(object) {
                object.css('animation-name', 'fadeOut');
	        	object.css('animation-duration', '200ms');
    	        object.css('animation-timing-function', 'ease-in-out');
        	    object.css('animation-iteration-count', '1');
        		object.css('animation-fill-mode', 'forwards');
                object.css('animation-play-state', 'running');
                setTimeout(function() {
                    object.css('display', 'none');
                }, 200)
		    };
        });
            
        $(document).ajaxComplete(function() {
            $.fn.goodBye(loading);
        });

        $.ajax({
            method: 'GET',
            url: endpoint,
            dataType: 'json',
            success: function(data) {
                words = data.words;
                freq = data.freqs;
                plotChart();
            },
            error: function(error_data) {
                console.log('Shit happens...');
                console.log(error_data);
            }
        });

        function plotChart() {
            var ctx = document.getElementById('result').getContext('2d');
            var result = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: words,
                    datasets: [{
                        label: 'Frequency',
                        data: freq,
                        backgroundColor: window.chartColors.grey,
                        borderColor: window.chartColors.black,
                        borderWidth: 1,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        labels: {
                            fontFamily: "'Source Code Pro', 'monospace'",
                            fontColor: 'black',
                        }
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontFamily: "'Source Code Pro', 'monospace'",
                                fontColor: 'black',
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontFamily: "'Source Code Pro', 'monospace'",
                                fontColor: 'black',
                                beginAtZero: true
                            }
                        }]
                    }
                }
            })
        };
    </script>
{% endblock %}