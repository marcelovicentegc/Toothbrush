{% extends "toothpaste/index.html" %}
{% block content %}
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js'></script>
    <div id='toothpaste'>
        <div id='loading'></div>
        <canvas id='result' width='400' height='400'></canvas>
    </div>
    <script>
        var loading = $('#loading'); 
        var endpoint = '/api/chart/data/{{id}}';
        var freq = [];
        var words = [];

        $(document).ready(function() {
            $.fn.goodBye = function(object) {
                object.css('animation-name', 'fadeOut');
	        	object.css('animation-duration', '200ms');
    	        object.css('animation-timing-function', 'ease-in-out');
        	    object.css('animation-iteration-count', '1');
        		object.css('animation-fill-mode', 'forwards');
                object.css('animation-play-state', 'running');
                setTimeout(function() {
                    object.css('display', 'none');
                }, 200)
		    };
        });
            
        $(document).ajaxComplete(function() {
            $.fn.goodBye(loading);
        });

        $.ajax({
            method: 'GET',
            url: endpoint,
            dataType: 'json',
            success: function(data) {
                words = data.words;
                freq = data.freqs;
                plotChart();
            },
            error: function(error_data) {
                console.log('Shit happens...');
                console.log(error_data);
            }
        });

        function plotChart() {
            var ctx = document.getElementById('result').getContext('2d');
            var result = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: words,
                    datasets: [{
                        label: 'Frequency',
                        data: freq,
                    }]
                },
                options: {
                    legend: {
                        labels: {
                            fontFamily: "'Source Code Pro', 'monospace'"
                        }
                    }
                }
            })
        };
    </script>
{% endblock %}